ARG BASE_IMAGE="ghcr.io/siddhantmodi/zephyr-ci:zsdk_v0.17.4"
FROM ${BASE_IMAGE}

USER root

RUN apt update && \
    apt -y install screen && \
    apt -y install openocd && \
    apt -y install udev && \
    usermod -aG dialout $USERNAME

# Install STM32 SVD files
RUN cd /opt && git clone --depth 1 https://github.com/modm-io/cmsis-svd-stm32
ENV SVD_DIR=/opt/cmsis-svd-stm32

# Switch to local user
USER $USERNAME
WORKDIR /home/$USERNAME/workspace
